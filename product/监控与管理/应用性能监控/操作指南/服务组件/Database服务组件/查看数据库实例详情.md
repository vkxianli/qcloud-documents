
Database 服务组件展示当前业务系统中所访问的所有 SQL 数据库组件的性能相关数据，用户可以查看当前业务系统中在统计周期内应用所访问的所有 SQL 数据库组件的列表。数据库组件列表默认按照平均执行时间从高到低进行排序，支持按不同指标项进行排序。
本文将为您介绍如何操作 Database 组件数据库实例详情。

## 前提条件


应用性能监控目前处于内测阶段，如需体验需通过 [应用性能监控内测申请](https://cloud.tencent.com/apply/p/f5yvbf09mka)。

## 操作步骤

1. 登录 [应用性能监控控制台](https://console.cloud.tencent.com/tapm)。
2. 在左侧菜单栏选择【服务组件】>【Database组件】，进入 Database 组件页面。
3. 您可以通过页面左上方的【业务系统】切换到其他业务系统，找到对应的实例，单击实例名称。
4. 进入实例详情页，即可查看实例 [概览](#overview)、[响应时间](#responsetime)、[错误](#erroranalysis)、[SQL分析](#sqlanalysis) 等相关数据。详细介绍如下：


## 概览[](id:overview)

数据库组件的概览界面如下图所示：
![](https://main.qcloudimg.com/raw/7f497a305e7910de5dbf8d3fb0d9bee9.png)
- **选择业务系统和组件**：在页面左上方的【业务系统】和【组件名称】下拉菜单中可切换业务系统和 Database 服务组件。
- **拓扑图**：拓扑图展示当前业务系统中当前数据库实例被事务访问的逻辑调用关系。拓扑图上以图标形式显示当前数据库实例和直接访问该数据库的事务，事务与数据库之间的连线上展示事务对该数据库实例的平均查询时间和平均吞吐率。
- **概要信息**：展示拓扑图中各个应用访问当前数据库实例的平均响应时间、响应总时间、执行次数、错误率、错误次数、调用该数据库实例的事务的个数和由于调用该数据库组件而发生的事务追踪次数。
- **健康度**：以堆叠条形图的形式展示，依据匹配的健康规则计算出的当前数据库实例的健康度变化趋势。
- **基本指标趋势图**：以曲线图的形式展示统计周期内当前业务系统访问该数据库实例的平均执行时间、吞吐率和数据库异常数量随时间变化的历史趋势。

##  响应时间[](id:responsetime)
### 平均响应时间

在平均响应时间模块您可以该数据库实例的平均响应时间趋势图和吞吐率的变化趋势。左侧纵坐标为吞吐率，右侧纵坐标为平均响应时间。

![](https://main.qcloudimg.com/raw/7cfe1302744972d16526f0762131b24c.png)

### 调用者（事务）分析
![](https://main.qcloudimg.com/raw/137df2a4e738cae013e1c1466ff689b3.png)
**调用者（事务）分析**列表显示所有调用该数据库实例的事务的性能详情。支持根据事务名称进行查询和1	··自定义列表展示字段。
- 调用者（应用）：该事务所属的应用。
- 调用者（服务接口）：如果是事务下游的服务接口调用的数据库实例，则该处显示服务接口名称。

## 错误[](id:erroranalysis)

错误详情页展示该数据库实例被调用时抛出的异常的统计情况。包括请求错误率的趋势图、错误数和请求总次数变化趋势。
![](https://main.qcloudimg.com/raw/7ba1b47c4fa65d1e5a0efd4779653569.png)

- **错误分析**：展示该数据库实例被调用时发生的所有异常列表，展示项包括异常信息、发生次数、错误率和影响用户数。
- **SQLs**：展示 SQL 错误次数。 
- **Root cause**：展示错误原因。
- **追踪列表**：展示由于调用该数据库实例而发生的所有事务追踪。
	 -  支持通过事务名称、用户标识和调用者（服务接口）搜索事务追踪。
	 -  默认仅显示存在 SQL 异常的事务追踪。




## SQL 分析[](id:sqlanalysis)


SQL 分析页面上以列表的形式列出当前统计周期内在当前数据库实例上执行的所有 SQL 语句及其性能信息，列表默认按平均响应时间从高到底排序。SQL 语句列表可以按发起 SQL 请求的事务、应用名称、实例名称和 SQL 语句内容进行查询。如下图所示：

![](https://main.qcloudimg.com/raw/9f2b87c1533c34603d391633a210aa47.jpg)

### 列表指标项

SQL 语句列表指标项包括：

-   SQL 语句：完整的标准化 SQL 语句，此处展示的 SQL语句为原始SQL语句进行标准化（包括去掉参数值，去掉多余的空格和回车等等）之后聚合而成的SQL 语句。
-   平均响应时间：统计周期内，当前数据库实例处理该 SQL访问的平均执行时间，可正反排序。默认按平均响应时间倒序排序（只查询前10000条数据）。
-   响应总时间：统计周期内，当前数据库实例处理多次 SQL 语句的总执行时间。
-   最大响应时间：统计周期内，当前数据库实例处理多次 SQL 语句中最耗时的一次的执行时间。
-   吞吐率：统计周期内，对当前数据库实例进行该 SQL操作的每秒平均调用次数，可正反排序。
-   SQL执行次数：统计周期内，对当前数据库实例进行该 SQL 操作的总调用次数。
-   错误次数：统计周期内，处理该 SQL请求时数据库实例发生异常的次数，可正反排序。
-   追踪次数：统计周期内，由于调用该SQL语句而发生的所有事务追踪次数，可正反排序。

### SQL 语句详情

在 SQL 语句列表中单击任意一条 SQL 语句，可进入该 SQL 语句的详细统计图表页面，如下图所示：
![](https://main.qcloudimg.com/raw/6de86116af4bba5fb95e5e5827d13d1c.jpg)


详细统计信息中包括以下内容：

#### 概要信息

概要信息展示各个应用访问当前 SQL 语句的平均响应时间、响应总时间、执行次数、错误率、错误次数、调用该 SQL 语句的事务的个数和由于调用该 SQL 语句而发生的事务追踪次数。

#### SQL

展示完整的 SQL 语句，您可以单击【复制SQL】复制  SQL 语句。

#### 性能页签

- 平均响应时间和吞吐率曲线：显示所选的 SQL 语句在统计周期内的平均执行时间和平均吞吐率趋势曲线图。
- 调用者（事务）分析：显示所有调用该SQL语句的事务的性能详情。支持根据事务名称进行查询。支持自定义列表字段。    
    - 调用者（应用）：该事务所属的应用。
    - 调用者（服务接口）：如果是事务下游的服务接口调用的 SQL 语句，则该处显示服务接口名称。
- 追踪列表：显示由于调用该SQL语句而发生的所有事务追踪。
    - 支持通过事务名称、用户标识和调用者（服务接口）搜索事务追踪。
    - 当勾选包含 SQL 异常复选框时，仅显示存在 SQL 异常的事务追踪。
    - 支持自定义列表字段。

#### 错误页签

- 错误率曲线：显示所选的 SQL 语句在统计周期内出现异常的执行次数占总执行次数的百分比趋势图、错误数和请求总次数的条形图。
- 错误分析：显示请求 SQL 语句时发生的所有异常列表，展示项包括异常信息、发生次数、错误率和影响用户数。
- 追踪列表：以列表形式展示包含该 SQL 语句的事务追踪的列表，点击列表项可跳转到对应的事务追踪详情页面，并定位到当前 SQL 语句的执行代码段位置。   
  - 支持通过事务名称、用户标识和调用者（服务接口）搜索事务追踪。
  - 当勾选**包含SQL异常**复选框时，仅显示存在 SQL 异常的事务追踪。默认为勾选状态。
  - 支持自定义列表字段。

#### 追踪列表
追踪列表包含以下指标项：
  - 时间：追踪的时间。
  - SQL 响应时间：在此次事务追踪记录中当前 SQL 语句的查响应耗时。
    >?当一个事务追踪包含多次对同一条 SQL 语句的操作时，在当前列表中将拆分成多条记录，每个 SQL 语句的执行独立为一条记录。
  - 调用者（事务）：调用该 SQL 语句的事务。
  - 响应时间：调用该 SQL 语句的这一次事务请求的响应时间。
  - 事务状态：包括成功和失败两种状态。
  - SQL 执行次数：这一次事务请求中调用该 SQL 语句的次数。
  - 错误次数：这一次事务请求中调用该 SQL 语句时抛出数据库异常的次数。
  - 用户标识：该次追踪的事务是由哪个用户访问的。
  - 调用者（应用）：事务追踪中直接调用此 SQL 语句的应用名称。
  - 调用者（服务接口）：如果是事务下游的服务接口调用的 SQL 语句，则该处显示服务接口名称。

