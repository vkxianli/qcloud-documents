TAPM 线程剖析是代码级的诊断工具，当服务器端应用出现系统卡顿或者响应慢时，您可以以非常低的系统开销对应用实例进行线程剖析，采集线程状态，定位性能消耗最大的线程和方法，进而突破性能瓶颈。

## 使用场景
- 在促销活动期间应用出现响应慢问题，严重影响客户体验和促销效果，TAPM 线程剖析可为您快速定位问题代码，避免销售损失。
- 当服务器端应用出现系统卡顿或者响应慢时，研发部门定位问题往往需要很长时间，并且需要研发、产品、运维多个部门的人员参与，效率较低。TAPM 线程剖析可快速定位性能消耗最大的线程和方法，问题定位时间大大缩短，并且减少了故障定位参与的部门和人员。
- 当业务比较复杂，偶发性的慢事务无法复现时，TAPM 线程剖析可为您还原代码的真实执行过程。
- 当应用出现大量的慢事务时，TAPM 线程剖析可为您及时保存现场。

## 设置剖析
1. 登录 [应用性能监控控制台](https://console.cloud.tencent.com/tapm)。
2. 在左侧导航栏中选择【应用】，然后在页面左上角的【业务系统】下拉菜单中选择目标业务系统。
3. 在应用列表中单击目标应用，进入应用详情页面。
4. 在页面顶部的【实例】下拉菜单选择待剖析的应用实例，然后单击【线程剖析】页签。
5. 选择实例。
   >?只可以选择一个实例，暂无实例时不能进行线程剖析。
6. 设置采样持续时间：1~10分钟的可选范围，默认选择2分钟。
7. 设置采样时间间隔：50~100毫秒的可选范围，默认选60毫秒。
8. 单击【开始剖析】按钮。
![](https://main.qcloudimg.com/raw/29326d5514d3353addf6a0dcb3bd4ae3.png)

## 查看剖析结果
剖析完成后，可在右侧的线程剖析列表中查看剖析结果。线程剖析列表展示采集成功的剖析数据，包括：开始剖析时间、持续时间、采集人。用户可删除所选的剖析记录。
单击一个剖析条目，可以查看所有线程的代码调用堆栈详细信息。默认展开最耗时线程的堆栈，即该应用的全部线程中耗时占比最高的线程。您还可以展开和收起所有线程和方法。
![](https://main.qcloudimg.com/raw/c285865cbbf41cc1d35b0ea990136047.png)
线程剖析的数据来自 TAPM 的 NBFS 文件系统，NBFS 文件系统中有4类数据：Agent、Task、Web 和 Other 。线程剖析不分析 Agent，只分析 Web、Task 和 Other3 类数据。默认展示行号。
- Web 代表Web 请求
- Task 代表后台任务
- Other 代表其他


