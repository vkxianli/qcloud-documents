身份访问控制是基于微信身份认证的远程运维访问控制功能。解决了传统静态 IP 白名单安全策略不适用于远程办公场景下的 IP 变动问题，也规避了云服务器运维端口被暴破或撞库的风险。身份访问控制功能无需部署实例和代理，也无需装客户端，即可为您带来“零部署、免代理、无客户端”的畅快体验。
## 背景信息
近来云上挖矿、勒索等安全事件猖獗，我们也收到了大量安全工单反馈，跟进溯源分析发现多数用户将22、3389远程运维端口直接暴露在互联网中，同时使用了强度较弱的登录口令，导致云服务器很容易被暴力破解登录，影响业务稳定性甚至系统崩溃。

在云上，22和3389端口是仅次于80、443和8080的第四大流量端口，同时也是远程运维和登录的重要端口，在此之前，用户可以通过在云防火墙中设置 IP 地址白名单的访问控制策略，来限制外部对其22端口的访问，但是由于疫情的影响，非职场办公已成为新常态，基于 IP 地址的白名单无法应对远程办公和运维的场景，因此我们设计了基于身份的访问控制功能，通过微信账号扫码认证的形式管控云服务器的远程登录，从源头上避免服务器被暴破登录。

### 功能特点
-	基于微信认证，安全便捷。
-	可在互联网边界，屏蔽管理端口，避免爆破和撞库。
-	零部署、免代理、无客户端。

### 功能流程
身份访问控制整体流程如下：
![](https://main.qcloudimg.com/raw/c8e5ffc975be8baadb49d419dfe5673e.png)
## 操作步骤
### 用户管理
企业管理员登录腾讯云防火墙控制台，注册运维用户并分配登录权限。
1. 登录 [云防火墙控制台](https://console.cloud.tencent.com/cfw/ac/auth)，在左侧导航栏中，选择【访问控制】>【身份访问控制】，进入身份访问控制页面。
2. 在身份访问控制页面的用户管理页签中，单击【添加用户】。
[](id:wx)
3. 在添加运维用户弹窗中，输入运维用户微信绑定的手机号，单击【下一步】。
![](https://main.qcloudimg.com/raw/597cec4464da922691a4eac21bcf1b95.png)
4. 编辑用户信息，获取微信昵称及头像，并输入备注以便识别用户（最长20字符），单击【下一步】。
>?此步骤不影响运维用户的远程连接，添加用户后，依然可以重新编辑用户信息。
>
![](https://main.qcloudimg.com/raw/2a364bc327e37774040e4727e1af9e50.png)
5. 配置用户权限，勾选允许该运维用户从公网进行访问的资产实例，单击【确定】，完成添加用户的操作。
![](https://main.qcloudimg.com/raw/df2f8343843f8a1a5b63fd1bf8403ece.png)
6. 此时用户管理页签内的用户列表，将会新增一个用户，单击该用户信息，将进入该用户详情页。
![](https://main.qcloudimg.com/raw/39785197a251182bed4109ed3120adea.png)
7. 在用户详情页，可重新编辑该用户的基本信息及相关权限。
	- 单击【编辑用户】，可重新编辑用户信息。
	- 单击【管理权限】，重新配置允许该用户从公网进行访问的资产实例。
	- 单击【查看行为】，可查看该用户对各个实例的访问和操作日志。
![](https://main.qcloudimg.com/raw/80c85991f8b2b393a78afa15ac63aa46.png)

### 实例管理
实例管理显示了全部公网 IP 所绑定的 CVM 实例列表，可基于实例进行权限管理，方便地查看实例可以被哪些用户访问。
1. 登录 [云防火墙控制台](https://console.cloud.tencent.com/cfw/ac/auth)，在左侧导航栏中，选择【访问控制】>【身份访问控制】，进入身份访问控制页面。
2.  在身份访问控制页面，单击【实例管理】。
3.  在实例管理页面，可查看全部公网 IP 所绑定的 CVM 实例列表及所授权用户，并可进行相关操作。
![](https://main.qcloudimg.com/raw/5da19168e3f230ee35015ce13bedafde.png)
	- **用户管理**：在右侧操作栏，单击【用户管理】，可对实例所授权的运维用户进行管理。
![](https://main.qcloudimg.com/raw/8ee84b002d7220ac2b6c71d55762931f.png)
	- **行为管理**：在右侧操作栏，单击【行为管理】，可查看运维用户针对该实例的远程运维行为，并基于用户或实例进行筛选，也可以回放运维人员的命令行操作。
	![](https://main.qcloudimg.com/raw/3189b734b846ab16065a1eed2237232b.png)
	
### 行为管理
1. 登录 [云防火墙控制台](https://console.cloud.tencent.com/cfw/ac/auth)，在左侧导航栏中，选择【访问控制】>【身份访问控制】，进入身份访问控制页面。
2. 在身份访问控制页面，单击【行为管理】。
3. 在行为管理页面，可查看运维用户远程运维的行为，并基于用户或实例进行筛选，也可以回放运维人员的命令行操作。
![](https://main.qcloudimg.com/raw/aece599c61143fd823d5de7f886f7d06.png)
	**命令回放**：在行为管理右侧操作栏，单击【回放】，可以播放运维人员的远程命令行操作记录。
![](https://main.qcloudimg.com/raw/c873b69318dedc01f3010ea73131f8f0.png)

### 远程登录
运维人员可用过如下步骤进行远程登录：
1. 命令行输入命令：`ssh cfw.tencentcs.com`。
2. 云防火墙会在命令行返回一个二维码，使用之前 [绑定的微信](#wx) 扫描此二维码。
>?如果二维码没有正常展示，在末尾处会有一个 URL 网址，访问此网址也可以展示二维码。
>
![](https://main.qcloudimg.com/raw/043a05388e78fb3981dafa87eb0d0386.png)
3. 在微信中，选择腾讯云账号和实例，进行授权登录。
![](https://main.qcloudimg.com/raw/3b38b31fc63e1e41f4373568034ee74c.png)
4. 授权登录后，请在1分钟内完成登录操作，否则需要重新授权。
>?如果选择记住登录密码，云防火墙会记录您在命令行登录的密码，后续登录不再需要手动登录，即使变更密码，防火墙也会自动记录新密码。
>
![](https://main.qcloudimg.com/raw/fa7231c2c8b0289be4b22cb457e7a278.png)
