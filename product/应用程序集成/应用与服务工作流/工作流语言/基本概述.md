## 腾讯云状态语言

腾讯云状态语言（Tencent Cloud States Language 简称：TCSL）是基于 JSON 的结构化语言，用来描述和定义工作流中的业务逻辑。 在执行时，ASW 工作流服务会根据工作流定义依次执行相关步骤。 下图为使用 TCSL 的代码示例：

```json
{
  "Comment": "使用Pass节点演示hello world示例",
  "StartAt": "Hello",
  "States": {
    "Hello": {
      "Type": "Pass",
      "Comment": "传递",
      "Next": "World"
    },
    "World": {
      "Type": "Pass",
      "Comment": "传递",
      "End": true
    }
  }
}
```


| 字段                         | 描述                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| Comment（可选）              | 您可以在此处输入工作流的备注信息。                           |
| StartAt（必选）              | 工作流的初始节点，工作流运行的第一个节点。                   |
| States（必选）               | 工作流所包含的所有节点的定义信息。详情请见 [节点](#step14) 部分。 |
| TimeoutMilliseconds （可选） | 工作流超时时间，正整数，单位毫秒。优先级高于 TimeoutSeconds  |
| TimeoutSeconds （可选）      | 工作流超时时间，正整数，单位秒，工作流超时时间。             |

>?工作流超时时间默认情况下：标准类型（1天），快速类型（1分钟）。更多详情参考 [工作流类型](https://cloud.tencent.com/document/product/1272/55018#.E5.B7.A5.E4.BD.9C.E6.B5.81.E7.B1.BB.E5.9E.8B)。

[](id:step14)
## 节点

节点是工作流的一个基本单元。每个节点接收输入数据，对数据进行操作处理后 ，将输出数据传递给向下一个节点。 节点可以是简单的原子节点，如 **Pass** 节点、**Task** 节点；也可以是复杂的逻辑控制节点，如 **Choice** 节点、**Map** 节点、**Parallel** 节点。节点的组合使用构建了复杂的业务逻辑。

- **Task** 节点
  使用 **Task** 节点来定义工作流调用的云服务资源信息，执行 **Task** 节点会调用相应的资源。
- **Pass** 节点
  使用 **Pass** 节点来输出常量或者将输入转换成期望的输出。通常用于构造和调试工作流 。
- **Choice** 节点
  使用 **Choice** 节点让工作流根据条件执行不同分支节点。
- **Parallel** 节点
  使用 **Parallel** 节点并行执行多个不同分支节点。
- **Map** 节点
  使用 **Map** 节点并行执行多个相同的节点，功能等同于 **forEach** 循环。

节点定义在 States 字段中，通过其名称来引用，名称任意字符串，但在整个工作流的范围内必须唯一。 

```json
{
    "States": {}
}
```

以下定义了两个节点，entry 节点接收传入的参数后，直接传递给 hello 节点，hello 节点执行云函数 helloFunction：

```json
{
  "States": {
    "entry": {
      "Type": "Pass",
      "Comment": "传递参数",
      "Next": "Hello"
    },
    "Hello": {
      "Type": "Task",
      "Resource": "qrn:qcs:asw:ap-guangzhou:123456789:sdk:json:qcloud:scf:Invoke/helloFunction",
      "End": true
    }
  }
}

```


[](id:step3)
### 常用字段

节点定义包含很多字段，以下为一些常用字段：

| 字段               | 描述                                                         |
| ------------------ | ------------------------------------------------------------ |
| Type（必填）       | 节点的类型。目前支持的节点类型为：Pass、Task、Choice、Parallel、Map。 |
| Next （二选一）    | 当前节点运行完毕后，下一个运行的节点名称。某些节点类型（例如 **Choice** 节点）内部支持多个 Next 节点。 |
| End（二选一）      | 如果设定 End 参数为 true，那么这个节点就是工作流的最后一个执行节点。一个节点只可以定义 Next 或 End。 |
| Comment（可选）    | 节点的描述信息。                                             |
| InputPath（可选）  | 用于选择传递到节点进行处理的数据。如果省略，它的值为 `$`，表示指定整个输入。详情参考 [InputPath](https://cloud.tencent.com/document/product/1272/55657#InputPath)。 |
| OutputPath（可选） | 用于选择节点处理后的输出数据。如果省略，它的值为 `$`，表示指定整个输出。详情参考 [OutputPath](https://cloud.tencent.com/document/product/1272/55657#OutputPath)。 |

## 数据

工作流的数据分以下三大类：

- 工作流的初始输入数据。
- 工作流之间传递的数据。
- 工作流的输出数据。

### 数据格式

工作流数据由 JSON 文本表示，因此您可以使用 JSON 支持的任意数据类型提供值。

> ?
>
> 1. JSON 文本格式的数字符合 JavaScript 语义。这些数字通常对应于双精度 [IEEE-854](https://standards.ieee.org/findstds/standard/854-1987.html) 值。
> 2. 有效的 JSON 文本包括：独立文本、引号分隔字符串、对象、数组、数字、布尔值以及 **null**。
> 3. 一个节点的输出成为下一个节点的输入。您可以使用 [输入与输出](https://cloud.tencent.com/document/product/1272/55657) 处理，将节点输出处理为输入数据的子集。

### 输入与输出

工作流的输入与输出仅支持 **JSON 对象**。如果不传递输入或输出，默认为空对象**{}**。

### 数据转换

工作流的运行是由不同节点间数据的相互转换来实现的。

工作流开始运行时，首先进入 **StartAt** 字段对应的节点，每个节点中的 **Next** 字段确定要进入的下一节点的名称。**StartAt** 和 **Next** 字段对应的值必须与某一节点的名称完全匹配。大部分节点只允许通过 **Next** 字段传递给下一个节点。某些逻辑控制节点 (例如，**Choice** 节点) 允许您指定多个分支节点，每个分支节点具有各自的 **Next** 字段。

数据一直在工作流节点中转换，直至到达最终（**"End": true** 节点）或者出现运行错误时结束。   

> !工作流的定义中，节点之间不能形成回路，否则工作流将运行超时并报错。

例如，以下节点表示 **SomeStep** 到  **NextStep** 的数据转换。

```
"SomeStep" : {
  ...,
  "Next" : "NextState"
}
```

工作流中的节点规则如下：

- 节点在 **States** 定义中可以按任意顺序出现，它们出现的顺序不会影响到它们的运行顺序。运行顺序由节点的 **Next** 字段所构成的逻辑决定。
- 在工作流中，只能有一个初始执行节点，它由顶级结构中 **StartAt** 字段的值指定。
- 根据您的工作流逻辑，您可能会有多个结束节点（例如工作流有多个执行分支时）。
- 如果工作流只包含一个节点，该节点可以为 **start** 状态和 **end** 节点。



